

<h1 class="title">Ruby on Rails Tutorial </h1>


<h1 class="subtitle">  Learn Rails by Example</h1>


<h2 class="author">Michael Hartl</h2>




<h2 class="contents">Contents</h2>


<div id="table_of_contents"><ol><li class="chapter"><a href="beginning#top"><span class="number">Chapter 1</span> From zero to deploy</a></li><li><ol><li class="section"><a href="beginning#sec-introduction"><span class="number">1.1</span> Introduction</a></li><li><ol><li class="subsection"><a href="beginning#sec-comments_for_various_readers"><span class="number">1.1.1</span> Comments for various readers</a></li><li class="subsection"><a href="beginning#sec-1_1_2"><span class="number">1.1.2</span> &ldquo;Scaling&rdquo; Rails</a></li><li class="subsection"><a href="beginning#sec-conventions"><span class="number">1.1.3</span> Conventions in this book</a></li></ol></li><li class="section"><a href="beginning#sec-up_and_running"><span class="number">1.2</span> Up and running</a></li><li><ol><li class="subsection"><a href="beginning#sec-development_tools"><span class="number">1.2.1</span> Development environments</a></li><li><ol><li class="subsubsection"><a href="beginning#sec-1_2_1_1">IDEs</a></li><li class="subsubsection"><a href="beginning#sec-1_2_1_2">Text editors and command lines</a></li><li class="subsubsection"><a href="beginning#sec-1_2_1_3">Browsers</a></li><li class="subsubsection"><a href="beginning#sec-1_2_1_4">A note about tools</a></li></ol></li><li class="subsection"><a href="beginning#sec-rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails, and Git</a></li><li><ol><li class="subsubsection"><a href="beginning#sec-rails_installer_windows">Rails Installer (Windows)</a></li><li class="subsubsection"><a href="beginning#sec-install_git">Install Git</a></li><li class="subsubsection"><a href="beginning#sec-install_ruby">Install Ruby</a></li><li class="subsubsection"><a href="beginning#sec-install_rubygems">Install RubyGems</a></li><li class="subsubsection"><a href="beginning#sec-install_rails">Install Rails</a></li></ol></li><li class="subsection"><a href="beginning#sec-the_first_application"><span class="number">1.2.3</span> The first application</a></li><li class="subsection"><a href="beginning#sec-bundler"><span class="number">1.2.4</span> Bundler</a></li><li class="subsection"><a href="beginning#sec-rails_server"><span class="number">1.2.5</span> <code>rails server</code></a></li><li class="subsection"><a href="beginning#sec-mvc"><span class="number">1.2.6</span> Model-view-controller (MVC)</a></li></ol></li><li class="section"><a href="beginning#sec-version_control"><span class="number">1.3</span> Version control with Git</a></li><li><ol><li class="subsection"><a href="beginning#sec-git_setup"><span class="number">1.3.1</span> Installation and setup</a></li><li><ol><li class="subsubsection"><a href="beginning#sec-1_3_1_1">First-time system setup</a></li><li class="subsubsection"><a href="beginning#sec-1_3_1_2">First-time repository setup</a></li></ol></li><li class="subsection"><a href="beginning#sec-adding_and_committing"><span class="number">1.3.2</span> Adding and committing</a></li><li class="subsection"><a href="beginning#sec-1_3_3"><span class="number">1.3.3</span> What good does Git do you?</a></li><li class="subsection"><a href="beginning#sec-github"><span class="number">1.3.4</span> GitHub</a></li><li class="subsection"><a href="beginning#sec-git_commands"><span class="number">1.3.5</span> Branch, edit, commit, merge</a></li><li><ol><li class="subsubsection"><a href="beginning#sec-git_branch">Branch</a></li><li class="subsubsection"><a href="beginning#sec-git_edit">Edit</a></li><li class="subsubsection"><a href="beginning#sec-git_commit">Commit</a></li><li class="subsubsection"><a href="beginning#sec-git_merge">Merge</a></li><li class="subsubsection"><a href="beginning#sec-git_push">Push</a></li></ol></li></ol></li><li class="section"><a href="beginning#sec-deploying"><span class="number">1.4</span> Deploying</a></li><li><ol><li class="subsection"><a href="beginning#sec-1_4_1"><span class="number">1.4.1</span> Heroku setup</a></li><li class="subsection"><a href="beginning#sec-heroku_step_one"><span class="number">1.4.2</span> Heroku deployment, step one</a></li><li class="subsection"><a href="beginning#sec-1_4_3"><span class="number">1.4.3</span> Heroku deployment, step two</a></li><li class="subsection"><a href="beginning#sec-heroku_commands"><span class="number">1.4.4</span> Heroku commands</a></li></ol></li><li class="section"><a href="beginning#sec-beginning_conclusion"><span class="number">1.5</span> Conclusion</a></li></ol></li><li class="chapter"><a href="a-demo-app#top"><span class="number">Chapter 2</span> A demo app</a></li><li><ol><li class="section"><a href="a-demo-app#sec-planning_the_application"><span class="number">2.1</span> Planning the application</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec-modeling_users"><span class="number">2.1.1</span> Modeling users</a></li><li class="subsection"><a href="a-demo-app#sec-modeling_microposts"><span class="number">2.1.2</span> Modeling microposts</a></li></ol></li><li class="section"><a href="a-demo-app#sec-demo_users_resource"><span class="number">2.2</span> The Users resource</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec-a_user_tour"><span class="number">2.2.1</span> A user tour</a></li><li class="subsection"><a href="a-demo-app#sec-mvc_in_action"><span class="number">2.2.2</span> MVC in action</a></li><li class="subsection"><a href="a-demo-app#sec-weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Weaknesses of this Users resource</a></li></ol></li><li class="section"><a href="a-demo-app#sec-microposts_resource"><span class="number">2.3</span> The Microposts resource</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec-a_micropost_microtour"><span class="number">2.3.1</span> A micropost microtour</a></li><li class="subsection"><a href="a-demo-app#sec-putting_the_micro_in_microposts"><span class="number">2.3.2</span> Putting the <em>micro</em> in microposts</a></li><li class="subsection"><a href="a-demo-app#sec-demo_user_has_many_microposts"><span class="number">2.3.3</span> A user <code>has_many</code> microposts</a></li><li class="subsection"><a href="a-demo-app#sec-inheritance_hierarchies"><span class="number">2.3.4</span> Inheritance hierarchies</a></li><li class="subsection"><a href="a-demo-app#sec-deploying_the_demo_app"><span class="number">2.3.5</span> Deploying the demo app</a></li></ol></li><li class="section"><a href="a-demo-app#sec-2_4"><span class="number">2.4</span> Conclusion</a></li></ol></li><li class="chapter"><a href="static-pages#top"><span class="number">Chapter 3</span> Mostly static pages</a></li><li><ol><li class="section"><a href="static-pages#sec-static_pages"><span class="number">3.1</span> Static pages</a></li><li><ol><li class="subsection"><a href="static-pages#sec-truly_static_pages"><span class="number">3.1.1</span> Truly static pages</a></li><li class="subsection"><a href="static-pages#sec-static_pages_with_rails"><span class="number">3.1.2</span> Static pages with Rails</a></li></ol></li><li class="section"><a href="static-pages#sec-first_tests"><span class="number">3.2</span> Our first tests</a></li><li><ol><li class="subsection"><a href="static-pages#sec-testing_tools"><span class="number">3.2.1</span> Testing tools</a></li><li><ol><li class="subsubsection"><a href="static-pages#sec-autotest">Autotest</a></li></ol></li><li class="subsection"><a href="static-pages#sec-TDD"><span class="number">3.2.2</span> TDD: Red, Green, Refactor</a></li><li><ol><li class="subsubsection"><a href="static-pages#sec-spork">Spork</a></li><li class="subsubsection"><a href="static-pages#sec-red">Red</a></li><li class="subsubsection"><a href="static-pages#sec-green">Green</a></li><li class="subsubsection"><a href="static-pages#sec-refactor">Refactor</a></li></ol></li></ol></li><li class="section"><a href="static-pages#sec-slightly_dynamic_pages"><span class="number">3.3</span> Slightly dynamic pages</a></li><li><ol><li class="subsection"><a href="static-pages#sec-testing_a_title_change"><span class="number">3.3.1</span> Testing a title change</a></li><li class="subsection"><a href="static-pages#sec-passing_title_tests"><span class="number">3.3.2</span> Passing title tests</a></li><li class="subsection"><a href="static-pages#sec-instance_variables_embedded_ruby"><span class="number">3.3.3</span> Instance variables and Embedded Ruby</a></li><li class="subsection"><a href="static-pages#sec-layouts"><span class="number">3.3.4</span> Eliminating duplication with layouts</a></li></ol></li><li class="section"><a href="static-pages#sec-static_pages_conclusion"><span class="number">3.4</span> Conclusion</a></li><li class="section"><a href="static-pages#sec-static_pages_exercises"><span class="number">3.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">Chapter 4</span> Rails-flavored Ruby</a></li><li><ol><li class="section"><a href="rails-flavored-ruby#sec-motivation"><span class="number">4.1</span> Motivation</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec-title_helper"><span class="number">4.1.1</span> A <code>title</code> helper</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-cascading_style_sheets"><span class="number">4.1.2</span> Cascading Style Sheets</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec-strings_and_methods"><span class="number">4.2</span> Strings and methods</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec-comments"><span class="number">4.2.1</span> Comments</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-strings"><span class="number">4.2.2</span> Strings</a></li><li><ol><li class="subsubsection"><a href="rails-flavored-ruby#sec-printing">Printing</a></li><li class="subsubsection"><a href="rails-flavored-ruby#sec-single_quoted_strings">Single-quoted strings</a></li></ol></li><li class="subsection"><a href="rails-flavored-ruby#sec-objects_and_message_passing"><span class="number">4.2.3</span> Objects and message passing</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-method_definitions"><span class="number">4.2.4</span> Method definitions</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-back_to_the_title_helper"><span class="number">4.2.5</span> Back to the <code>title</code> helper</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec-other_data_structures"><span class="number">4.3</span> Other data structures</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec-arrays_and_ranges"><span class="number">4.3.1</span> Arrays and ranges</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-blocks"><span class="number">4.3.2</span> Blocks</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-hashes_and_symbols"><span class="number">4.3.3</span> Hashes and symbols</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-css_revisited"><span class="number">4.3.4</span> CSS revisited</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec-ruby_classes"><span class="number">4.4</span> Ruby classes</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec-constructors"><span class="number">4.4.1</span> Constructors</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-a_class_of_our_own"><span class="number">4.4.2</span> Class inheritance</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-modifying_built_in_classes"><span class="number">4.4.3</span> Modifying built-in classes</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-a_controller_class"><span class="number">4.4.4</span> A controller class</a></li><li class="subsection"><a href="rails-flavored-ruby#sec-a_user_class"><span class="number">4.4.5</span> A user class</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec-exercises"><span class="number">4.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="filling-in-the-layout#top"><span class="number">Chapter 5</span> Filling in the layout</a></li><li><ol><li class="section"><a href="filling-in-the-layout#sec-structure"><span class="number">5.1</span> Adding some structure</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec-adding_to_the_layout"><span class="number">5.1.1</span> Site navigation</a></li><li class="subsection"><a href="filling-in-the-layout#sec-custom_css"><span class="number">5.1.2</span> Custom CSS</a></li><li class="subsection"><a href="filling-in-the-layout#sec-partials"><span class="number">5.1.3</span> Partials</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec-layout_links"><span class="number">5.2</span> Layout links</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec-integration_tests"><span class="number">5.2.1</span> Integration tests</a></li><li class="subsection"><a href="filling-in-the-layout#sec-rails_routes"><span class="number">5.2.2</span> Rails routes</a></li><li class="subsection"><a href="filling-in-the-layout#sec-named_routes"><span class="number">5.2.3</span> Named routes</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec-user_signup"><span class="number">5.3</span> User signup: A first step</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec-users_controller"><span class="number">5.3.1</span> Users controller</a></li><li class="subsection"><a href="filling-in-the-layout#sec-signup_url"><span class="number">5.3.2</span> Signup URL</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec-layout_conclusion"><span class="number">5.4</span> Conclusion</a></li><li class="section"><a href="filling-in-the-layout#sec-layout_exercises"><span class="number">5.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="modeling-and-viewing-users-one#top"><span class="number">Chapter 6</span> Modeling and viewing users, part I</a></li><li><ol><li class="section"><a href="modeling-and-viewing-users-one#sec-user_model"><span class="number">6.1</span> User model</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec-database_migrations"><span class="number">6.1.1</span> Database migrations</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-the_model_file"><span class="number">6.1.2</span> The model file</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec-model_annotation">Model annotation</a></li><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec-accessible_attributes">Accessible attributes</a></li></ol></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-creating_user_objects"><span class="number">6.1.3</span> Creating user objects</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-finding_user_objects"><span class="number">6.1.4</span> Finding user objects</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-updating_user_objects"><span class="number">6.1.5</span> Updating user objects</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec-user_validations"><span class="number">6.2</span> User validations</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec-presence_validation"><span class="number">6.2.1</span> Validating presence</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-length_validation"><span class="number">6.2.2</span> Length validation</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-format_validation"><span class="number">6.2.3</span> Format validation</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-uniqueness_validation"><span class="number">6.2.4</span> Uniqueness validation</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec-the_caveat">The uniqueness caveat</a></li></ol></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec-viewing_users"><span class="number">6.3</span> Viewing users</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec-rails_environments"><span class="number">6.3.1</span> Debug and Rails environments</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-users_show"><span class="number">6.3.2</span> User model, view, controller</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec-a_users_resource"><span class="number">6.3.3</span> A Users resource</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec-params_in_debug"><code>params</code> in <code>debug</code></a></li></ol></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec-6_4"><span class="number">6.4</span> Conclusion</a></li><li class="section"><a href="modeling-and-viewing-users-one#sec-6_5"><span class="number">6.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="modeling-and-viewing-users-two#top"><span class="number">Chapter 7</span> Modeling and viewing users, part II</a></li><li><ol><li class="section"><a href="modeling-and-viewing-users-two#sec-insecure_passwords"><span class="number">7.1</span> Insecure passwords</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec-password_validations"><span class="number">7.1.1</span> Password validations</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec-password_migration"><span class="number">7.1.2</span> A password migration</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec-an_active_record_callback"><span class="number">7.1.3</span> An Active Record callback</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec-secure_passwords"><span class="number">7.2</span> Secure passwords</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec-a_secure_password_test"><span class="number">7.2.1</span> A secure password test</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec-secure_password_theory"><span class="number">7.2.2</span> Some secure password theory</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec-implementing_has_password"><span class="number">7.2.3</span> Implementing <code>has_password?</code></a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec-an_authenticate_method"><span class="number">7.2.4</span> An authenticate method</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec-better_user_views"><span class="number">7.3</span> Better user views</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec-tests_with_factories"><span class="number">7.3.1</span> Testing the user show page (with factories)</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec-a_name_and_a_gravatar"><span class="number">7.3.2</span> A name and a Gravatar</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-two#sec-a_gravatar_helper">A Gravatar helper</a></li></ol></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec-a_user_sidebar"><span class="number">7.3.3</span> A user sidebar</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec-7_4"><span class="number">7.4</span> Conclusion</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec-7_4_1"><span class="number">7.4.1</span> Git commit</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec-heroku_deploy"><span class="number">7.4.2</span> Heroku deploy</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec-more_modeling_users_exercises"><span class="number">7.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="sign-up#top"><span class="number">Chapter 8</span> Sign up</a></li><li><ol><li class="section"><a href="sign-up#sec-signup_form"><span class="number">8.1</span> Signup form</a></li><li><ol><li class="subsection"><a href="sign-up#sec-using_form_for"><span class="number">8.1.1</span> Using <code>form_for</code></a></li><li class="subsection"><a href="sign-up#sec-the_form_html"><span class="number">8.1.2</span> The form HTML</a></li></ol></li><li class="section"><a href="sign-up#sec-signup_failure"><span class="number">8.2</span> Signup failure</a></li><li><ol><li class="subsection"><a href="sign-up#sec-testing_failure"><span class="number">8.2.1</span> Testing failure</a></li><li class="subsection"><a href="sign-up#sec-a_working_form"><span class="number">8.2.2</span> A working form</a></li><li class="subsection"><a href="sign-up#sec-signup_error_messages"><span class="number">8.2.3</span> Signup error messages</a></li><li class="subsection"><a href="sign-up#sec-filtering_parameter_logging"><span class="number">8.2.4</span> Filtering parameter logging</a></li></ol></li><li class="section"><a href="sign-up#sec-signup_success"><span class="number">8.3</span> Signup success</a></li><li><ol><li class="subsection"><a href="sign-up#sec-testing_success"><span class="number">8.3.1</span> Testing success</a></li><li class="subsection"><a href="sign-up#sec-the_finished_signup_form"><span class="number">8.3.2</span> The finished signup form</a></li><li class="subsection"><a href="sign-up#sec-the_flash"><span class="number">8.3.3</span> The flash</a></li><li class="subsection"><a href="sign-up#sec-the_first_signup"><span class="number">8.3.4</span> The first signup</a></li></ol></li><li class="section"><a href="sign-up#sec-rspec_integration_tests"><span class="number">8.4</span> RSpec integration tests</a></li><li><ol><li class="subsection"><a href="sign-up#sec-integration_tests_with_style"><span class="number">8.4.1</span> Integration tests with style</a></li><li class="subsection"><a href="sign-up#sec-failed_signup"><span class="number">8.4.2</span> Users signup failure should not make a new user</a></li><li class="subsection"><a href="sign-up#sec-successful_signup"><span class="number">8.4.3</span> Users signup success should make a new user</a></li></ol></li><li class="section"><a href="sign-up#sec-8_5"><span class="number">8.5</span> Conclusion</a></li><li class="section"><a href="sign-up#sec-signup_exercises"><span class="number">8.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="sign-in-sign-out#top"><span class="number">Chapter 9</span> Sign in, sign out</a></li><li><ol><li class="section"><a href="sign-in-sign-out#sec-sessions"><span class="number">9.1</span> Sessions</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec-sessions_controller"><span class="number">9.1.1</span> Sessions controller</a></li><li class="subsection"><a href="sign-in-sign-out#sec-signin_form"><span class="number">9.1.2</span> Signin form</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec-signin_failure"><span class="number">9.2</span> Signin failure</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec-reviewing_form_submission"><span class="number">9.2.1</span> Reviewing form submission</a></li><li class="subsection"><a href="sign-in-sign-out#sec-failed_signin"><span class="number">9.2.2</span> Failed signin (test and code)</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec-signin_success"><span class="number">9.3</span> Signin success</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec-the_completed_create_action"><span class="number">9.3.1</span> The completed <code>create</code> action</a></li><li class="subsection"><a href="sign-in-sign-out#sec-remember_me"><span class="number">9.3.2</span> Remember me</a></li><li class="subsection"><a href="sign-in-sign-out#sec-current_user"><span class="number">9.3.3</span> Current user</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec-signing_out"><span class="number">9.4</span> Signing out</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec-destroying_sessions"><span class="number">9.4.1</span> Destroying sessions</a></li><li class="subsection"><a href="sign-in-sign-out#sec-signin_upon_signup"><span class="number">9.4.2</span> Signin upon signup</a></li><li class="subsection"><a href="sign-in-sign-out#sec-changing_the_layout_links"><span class="number">9.4.3</span> Changing the layout links</a></li><li class="subsection"><a href="sign-in-sign-out#sec-signin_out_integration_tests"><span class="number">9.4.4</span> Signin/out integration tests</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec-9_5"><span class="number">9.5</span> Conclusion</a></li><li class="section"><a href="sign-in-sign-out#sec-sign_in_out_exercises"><span class="number">9.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Chapter 10</span> Updating, showing, and deleting users</a></li><li><ol><li class="section"><a href="updating-showing-and-deleting-users#sec-updating_users"><span class="number">10.1</span> Updating users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec-edit_form"><span class="number">10.1.1</span> Edit form</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec-enabling_edits"><span class="number">10.1.2</span> Enabling edits</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec-protecting_pages"><span class="number">10.2</span> Protecting pages</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec-requiring_signed_in_users"><span class="number">10.2.1</span> Requiring signed-in users</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec-requiring_the_right_user"><span class="number">10.2.2</span> Requiring the right user</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec-friendly_forwarding"><span class="number">10.2.3</span> Friendly forwarding</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec-showing_users"><span class="number">10.3</span> Showing users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec-user_index"><span class="number">10.3.1</span> User index</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec-sample_users"><span class="number">10.3.2</span> Sample users</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec-pagination"><span class="number">10.3.3</span> Pagination</a></li><li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec-testing_pagination">Testing pagination</a></li></ol></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec-partial_refactoring"><span class="number">10.3.4</span> Partial refactoring</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec-destroying_users"><span class="number">10.4</span> Destroying users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec-administrative_users"><span class="number">10.4.1</span> Administrative users</a></li><li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec-revisiting_attr_accessible">Revisiting <code>attr_accessible</code></a></li></ol></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec-the_destroy_action"><span class="number">10.4.2</span> The <code>destroy</code> action</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec-10_5"><span class="number">10.5</span> Conclusion</a></li><li class="section"><a href="updating-showing-and-deleting-users#sec-updating_deleting_exercises"><span class="number">10.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="user-microposts#top"><span class="number">Chapter 11</span> User microposts</a></li><li><ol><li class="section"><a href="user-microposts#sec-a_micropost_model"><span class="number">11.1</span> A Micropost model</a></li><li><ol><li class="subsection"><a href="user-microposts#sec-the_basic_model"><span class="number">11.1.1</span> The basic model</a></li><li><ol><li class="subsubsection"><a href="user-microposts#sec-accessible_attribute">Accessible attribute</a></li></ol></li><li class="subsection"><a href="user-microposts#sec-user_micropost_associations"><span class="number">11.1.2</span> User/Micropost associations</a></li><li class="subsection"><a href="user-microposts#sec-ordering_and_dependency"><span class="number">11.1.3</span> Micropost refinements</a></li><li><ol><li class="subsubsection"><a href="user-microposts#sec-default_scope">Default scope</a></li><li class="subsubsection"><a href="user-microposts#sec-dependent_destroy">Dependent: destroy</a></li></ol></li><li class="subsection"><a href="user-microposts#sec-micropost_validations"><span class="number">11.1.4</span> Micropost validations</a></li></ol></li><li class="section"><a href="user-microposts#sec-showing_microposts"><span class="number">11.2</span> Showing microposts</a></li><li><ol><li class="subsection"><a href="user-microposts#sec-augmenting_the_user_show_page"><span class="number">11.2.1</span> Augmenting the user show page</a></li><li class="subsection"><a href="user-microposts#sec-sample_microposts"><span class="number">11.2.2</span> Sample microposts</a></li></ol></li><li class="section"><a href="user-microposts#sec-manipulating_microposts"><span class="number">11.3</span> Manipulating microposts</a></li><li><ol><li class="subsection"><a href="user-microposts#sec-access_control"><span class="number">11.3.1</span> Access control</a></li><li class="subsection"><a href="user-microposts#sec-creating_microposts"><span class="number">11.3.2</span> Creating microposts</a></li><li class="subsection"><a href="user-microposts#sec-a_proto_feed"><span class="number">11.3.3</span> A proto-feed</a></li><li class="subsection"><a href="user-microposts#sec-destroying_microposts"><span class="number">11.3.4</span> Destroying microposts</a></li><li class="subsection"><a href="user-microposts#sec-testing_the_new_home_page"><span class="number">11.3.5</span> Testing the new home page</a></li></ol></li><li class="section"><a href="user-microposts#sec-11_4"><span class="number">11.4</span> Conclusion</a></li><li class="section"><a href="user-microposts#sec-micropost_exercises"><span class="number">11.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="following-users#top"><span class="number">Chapter 12</span> Following users</a></li><li><ol><li class="section"><a href="following-users#sec-the_relationship_model"><span class="number">12.1</span> The Relationship model</a></li><li><ol><li class="subsection"><a href="following-users#sec-a_problem_with_the_data_model"><span class="number">12.1.1</span> A problem with the data model (and a solution)</a></li><li class="subsection"><a href="following-users#sec-relationship_user_associations"><span class="number">12.1.2</span> User/relationship associations</a></li><li class="subsection"><a href="following-users#sec-relationship_validations"><span class="number">12.1.3</span> Validations</a></li><li class="subsection"><a href="following-users#sec-following"><span class="number">12.1.4</span> Following</a></li><li class="subsection"><a href="following-users#sec-followers"><span class="number">12.1.5</span> Followers</a></li></ol></li><li class="section"><a href="following-users#sec-a_web_interface_for_following_and_followers"><span class="number">12.2</span> A web interface for following and followers</a></li><li><ol><li class="subsection"><a href="following-users#sec-sample_following_data"><span class="number">12.2.1</span> Sample following data</a></li><li class="subsection"><a href="following-users#sec-stats_and_a_follow_form"><span class="number">12.2.2</span> Stats and a follow form</a></li><li class="subsection"><a href="following-users#sec-following_and_followers_pages"><span class="number">12.2.3</span> Following and followers pages</a></li><li class="subsection"><a href="following-users#sec-a_working_follow_button_the_standard_way"><span class="number">12.2.4</span> A working follow button the standard way</a></li><li class="subsection"><a href="following-users#sec-a_working_follow_button_with_ajax"><span class="number">12.2.5</span> A working follow button with Ajax</a></li></ol></li><li class="section"><a href="following-users#sec-the_status_feed"><span class="number">12.3</span> The status feed</a></li><li><ol><li class="subsection"><a href="following-users#sec-motivation_and_strategy"><span class="number">12.3.1</span> Motivation and strategy</a></li><li class="subsection"><a href="following-users#sec-a_first_feed_implementation"><span class="number">12.3.2</span> A first feed implementation</a></li><li class="subsection"><a href="following-users#sec-scopes_subselects_and_a_lambda"><span class="number">12.3.3</span> Scopes, subselects, and a lambda</a></li><li class="subsection"><a href="following-users#sec-the_new_status_feed"><span class="number">12.3.4</span> The new status feed</a></li></ol></li><li class="section"><a href="following-users#sec-following_conclusion"><span class="number">12.4</span> Conclusion</a></li><li><ol><li class="subsection"><a href="following-users#sec-extensions_to_the_sample_application"><span class="number">12.4.1</span> Extensions to the sample application</a></li><li><ol><li class="subsubsection"><a href="following-users#sec-replies">Replies</a></li><li class="subsubsection"><a href="following-users#sec-messaging">Messaging</a></li><li class="subsubsection"><a href="following-users#sec-follower_notifications">Follower notifications</a></li><li class="subsubsection"><a href="following-users#sec-password_reminders">Password reminders</a></li><li class="subsubsection"><a href="following-users#sec-signup_confirmation">Signup confirmation</a></li><li class="subsubsection"><a href="following-users#sec-rss_feed">RSS feed</a></li><li class="subsubsection"><a href="following-users#sec-rest_api">REST API</a></li><li class="subsubsection"><a href="following-users#sec-search">Search</a></li></ol></li><li class="subsection"><a href="following-users#sec-guide_to_further_resources"><span class="number">12.4.2</span> Guide to further resources</a></li></ol></li><li class="section"><a href="following-users#sec-following_exercises"><span class="number">12.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="rails-3-1#top"><span class="number">Chapter 13</span> Rails 3.1</a></li><li><ol><li class="section"><a href="rails-3-1#sec-upgrading_the_sample_app"><span class="number">13.1</span> Upgrading the sample app</a></li><li><ol><li class="subsection"><a href="rails-3-1#sec-installing_and_configuring_rails_3_1"><span class="number">13.1.1</span> Installing and configuring Rails&nbsp;3.1</a></li><li class="subsection"><a href="rails-3-1#sec-getting_to_red"><span class="number">13.1.2</span> Getting to Red</a></li><li class="subsection"><a href="rails-3-1#sec-minor_issues"><span class="number">13.1.3</span> Minor issues</a></li><li><ol><li class="subsubsection"><a href="rails-3-1#sec-will_paginate">will_paginate</a></li><li class="subsubsection"><a href="rails-3-1#sec-pagination_spec">Pagination spec</a></li></ol></li><li class="subsection"><a href="rails-3-1#sec-major_differences"><span class="number">13.1.4</span> Major differences</a></li><li><ol><li class="subsubsection"><a href="rails-3-1#sec-asset_directories">Asset directories</a></li><li class="subsubsection"><a href="rails-3-1#sec-prototype_to_jquery">Prototype to jQuery</a></li></ol></li></ol></li><li class="section"><a href="rails-3-1#sec-new_features"><span class="number">13.2</span> New features in Rails 3.1</a></li><li><ol><li class="subsection"><a href="rails-3-1#sec-asset_pipeline"><span class="number">13.2.1</span> Asset pipeline</a></li><li class="subsection"><a href="rails-3-1#sec-reversible_migrations"><span class="number">13.2.2</span> Reversible migrations</a></li><li class="subsection"><a href="rails-3-1#sec-sass_and_coffeescript"><span class="number">13.2.3</span> Sass and CoffeeScript</a></li></ol></li><li class="section"><a href="rails-3-1#sec-rails_3_1_exercises"><span class="number">13.3</span> Exercises</a></li></ol></li></ol></div>


<div id="main_content"></div>


<p> <span class="preamble">
 <span id="foreword">
<strong> Foreword</strong> <br />
 </span>
 </span></p>

<p>My former company (CD Baby) was one of the first to loudly switch to Ruby on Rails, and then even more loudly switch back to PHP (Google me to read about the drama). This book by Michael Hartl came so highly recommended that I had to try it, and <em>Ruby on Rails Tutorial</em> is what I used to switch back to Rails again.</p>

<p>Though I&rsquo;ve worked my way through many Rails books, this is the one that finally made me &ldquo;get&rdquo; it. Everything is done very much &ldquo;the Rails way&rdquo;&mdash;a way that felt very unnatural to me before, but now after doing this book finally feels natural. This is also the only Rails book that does test-driven development the entire time, an approach highly recommended by the experts but which has never been so clearly demonstrated before. Finally, by including Git, GitHub, and Heroku in the demo examples, the author really gives you a feel for what it&rsquo;s like to do a real-world project. The tutorial&rsquo;s code examples are not in isolation.</p>

<p>The linear narrative is such a great format. Personally, I powered through <em>Rails Tutorial</em> in three long days, doing all the examples and challenges at the end of each chapter. Do it from start to finish, without jumping around, and you&rsquo;ll get the ultimate benefit.</p>

<p>Enjoy!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>Formerly: Founder,</em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br />
<em>Currently: Founder,</em> <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> <br /></p>

<p> <span class="preamble">
<strong> Acknowledgments</strong> <br />
 </span></p>

<p><em>Ruby on Rails Tutorial</em> owes a lot to my previous Rails book, <em>RailsSpace</em>, and hence to my coauthor <a href="http://aure.com/">Aurelius Prochazka</a>. I&rsquo;d like to thank Aure both for the work he did on that book and for his support of this one. I&rsquo;d also like to thank Debra Williams Cauley, my editor on both <em>RailsSpace</em> and <em>Rails Tutorial</em>; as long as she keeps taking me to baseball games, I&rsquo;ll keep writing books for her.</p>

<p>I&rsquo;d like to acknowledge a long list of Rubyists who have taught and inspired me over the years: David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Wolfram Arnold, Alex Chaffee, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, the good people at Pivotal Labs, the Heroku gang, the thoughtbot guys, and the GitHub crew. Finally, many, many readers&mdash;far too many to list&mdash;have contributed a huge number of bug reports and suggestions during the writing of this book, and I gratefully acknowledge their help in making it as good as it can&nbsp;be. <br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> About the author</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Michael Hartl</a> is a programmer, educator, and entrepreneur. Michael was coauthor of <em>RailsSpace</em>, a best-selling Rails tutorial book published in 2007, and was cofounder and lead developer of <a href="http://insoshi.com/">Insoshi</a>, a popular social networking platform in Ruby on Rails. Previously, he taught theoretical and computational physics at the <a href="http://www.caltech.edu/">California Institute of Technology</a> (Caltech), where he received the Lifetime Achievement Award for Excellence in Teaching. Michael is a graduate of <a href="http://college.harvard.edu/">Harvard College</a>, has a <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">Ph.D. in Physics</a> from <a href="http://www.caltech.edu/">Caltech</a>, and is an alumnus of the <a href="http://ycombinator.com/">Y&nbsp;Combinator</a> entrepreneur program. <br /></p>

<p> <span id="license" class="preamble">
<strong> Copyright and license</strong> <br />
 </span></p>

<p><em>Ruby on Rails Tutorial: Learn Rails by Example</em>. Copyright &copy; 2010 by Michael Hartl. All source code in <em>Ruby on Rails Tutorial</em> is available under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> and the <a href="http://en.wikipedia.org/wiki/Beerware">Beerware License</a>.</p>

<pre class="verbatim">   Copyright (c) 2010 Michael Hartl

   Permission is hereby granted, free of charge, to any person
   obtaining a copy of this software and associated documentation
   files (the &quot;Software&quot;), to deal in the Software without
   restriction, including without limitation the rights to use,
   copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following
   conditions:

   The above copyright notice and this permission notice shall be
   included in all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
   OTHER DEALINGS IN THE SOFTWARE.</pre>




<pre class="verbatim">/*
 * ------------------------------------------------------------
 * &quot;THE BEERWARE LICENSE&quot; (Revision 42):
 * Michael Hartl wrote this code. As long as you retain this 
 * notice, you can do whatever you want with this stuff. If we
 * meet someday, and you think this stuff is worth it, you can
 * buy me a beer in return.
 * ------------------------------------------------------------
 */</pre>




<div id="top"></div>


<h1 class="chapter"><a id="sec-13" href="rails-3-1#top" class="heading"><span class="number">Chapter 13</span> Rails 3.1</a></h1>


<p>Even seven years after its initial release, Ruby on Rails continues to be on the cutting edge of web application development, and each new version of Rails includes features that make Rails applications more powerful and Rails application developers more productive. Rails&nbsp;3.1&mdash;available as a release candidate as of this writing&mdash;is no exception. This chapter provides a description of how to upgrade the Rails Tutorial sample application from Rails&nbsp;3.0 to Rails&nbsp;3.1 (<a class="ref" href="rails-3-1#sec-upgrading_the_sample_app">Section&nbsp;13.1</a>), as well as a brief overview of some of the more interesting new features in Rails&nbsp;3.1 (<a class="ref" href="rails-3-1#sec-new_features">Section&nbsp;13.2</a>).</p>

<p>As noted in <a class="ref" href="beginning#sec-install_rails">Section&nbsp;1.2.2.5</a>, there are a few backwards-incompatible changes in Rails&nbsp;3.1, several of which affect the sample application. Principal among these are a new convention for the placement of images, stylesheets, and JavaScript files&mdash;collectively known as <em>assets</em>&mdash;and a change in the default JavaScript library from <a href="http://www.prototypejs.org/">Prototype</a> to <a href="http://jquery.com/">jQuery</a>. <a class="ref" href="rails-3-1#sec-major_differences">Section&nbsp;13.1.4</a> discusses these changes in more depth.</p>

<p>Rails&nbsp;3.1 also includes some changes that, while compatible with Rails&nbsp;3.0 applications, will nevertheless affect the development of applications in the future. These new features include <em>reversible migrations</em> and the inclusion of <a href="http://sass-lang.com/">Sass</a> and <a href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a> as new defaults. A brief overview of these changes, and pointers to more detailed resources, appear in <a class="ref" href="rails-3-1#sec-new_features">Section&nbsp;13.2</a>.</p>

<p>Finally, a future edition of this book (and a new version of the accompanying <a href="http://railstutorial.org/screencasts">screencasts</a>) will use Rails&nbsp;3.1 (or a more up-to-date version if available) from the beginning. I plan to cover both Sass and CoffeeScript, as well as some of the changes in other parts of the Ruby and Rails ecosystems (such as improved RSpec syntax) that will be valuable to beginning Rails developers. Subscribe to the <a href="http://news.railstutorial.org/">Rails Tutorial news feed</a> to be notified when the new edition is available.</p>

<p>With every new Rails release, there is a time delay while the rest of the ecosystem catches up. For example, as of this writing, Rails&nbsp;3.1 application deployment to Heroku is not yet supported, and (as discussed in <a class="ref" href="rails-3-1#sec-minor_issues">Section&nbsp;13.1.3</a>) the <tt>will_paginate</tt> gem is broken. This is the price we pay for being on the bleeding edge&mdash;sometimes we get cut.</p>

<div class="label" id="sec-upgrading_the_sample_app"></div>


<h2><a id="sec-13_1" href="rails-3-1#sec-upgrading_the_sample_app" class="heading"><span class="number">13.1</span> Upgrading the sample app</a></h2>


<p>Our first step in getting a handle on Rails&nbsp;3.1 is to upgrade the sample application developed in <a class="ref" href="static-pages#top">Chapter&nbsp;3</a> through <a class="ref" href="following-users#top">Chapter&nbsp;12</a>. There are two possible strategies for accomplishing this. The first is to edit the sample application directly, changing the <code>Gemfile</code> and the configuration files, and then dealing with any breakage that ensues. Some online resources to help with this approach are <a href="http://jasonrudolph.com/blog/2011/06/06/helpful-resources-for-upgrading-to-rails-3-1/">Helpful resources for upgrading to Rails&nbsp;3.1</a> and <a href="http://davidjrice.co.uk/2011/05/25/how-to-upgrade-a-rails-application-to-version-3-1-0.html">How to upgrade a Rails application to version 3.1.0</a>. In this chapter, we&rsquo;ll take a second approach, which is to create a new Rails&nbsp;3.1 application from scratch, and then copy over files one by one from the existing sample application until we get the new application to work.</p>

<p>There are several advantages to this second approach. For one, because we will generate the initial application using <code>rails new</code>, the <code>Gemfile</code> and configuration files will automatically be configured correctly for Rails&nbsp;3.1. In addition, by adding one file at a time (or, at most, a few) we can more easily isolate the source of any breakage. The downside is that we might forget a file or two, leading to a broken application, although this is unlikely because of our thorough test suite. Ultimately, the right strategy probably depends on the exact nature of the app; in my judgment, the best way to upgrade the sample application is using this second strategy, but you are free to try the first.</p>

<p>For a more detailed treatment of the topics in this section, please see the <a href="http://ruby.railstutorial.org/screencasts">Ruby on Rails Tutorial screencasts</a>, which now include a bonus Lesson&nbsp;13 on Rails&nbsp;3.1. Among other things, after completing the full Rails&nbsp;3.1 upgrade, the screencast shows how to create a dedicated <tt>rails-3-1</tt> branch in the main sample app&rsquo;s Git repository. As a result, if you want to compare your work to the book&rsquo;s sample application code, you can find <a href="https://github.com/railstutorial/sample_app/tree/rails-3-1">the <tt>rails-3-1</tt> branch at GitHub</a>.</p>

<div class="label" id="sec-installing_and_configuring_rails_3_1"></div>


<h3><a id="sec-13_1_1" href="rails-3-1#sec-installing_and_configuring_rails_3_1" class="heading"><span class="number">13.1.1</span> Installing and configuring Rails&nbsp;3.1</a></h3>


<p>To get started with the Rails&nbsp;3.1 upgrade, it is a good idea to create a dedicated <a href="http://rvm.beginrescueend.com/gemsets/">gemset</a> if you are using <a href="https://rvm.beginrescueend.com/">Ruby Version Manager (RVM)</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm --create use 1.9.2@rails3_1tutorial
</pre></div>
</div>


<p>Whether you&rsquo;re using RVM or not, you will need to install Rails&nbsp;3.1:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> gem install rails --version 3.1.0
</pre></div>
</div>


<p>(If you get a permissions error here, recall from <a class="ref" href="beginning#sec-conventions">Section&nbsp;1.1.3</a> that you may have to use <code>sudo</code>.)</p>

<p>Once you have installed Rails, you can verify that you have the right version as follows:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails -v
<span class="go">Rails 3.1.0</span>
</pre></div>
</div>


<p>Then create a dedicated Rails&nbsp;3.1 sample app skeleton:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new sample_app_3_1
</pre></div>
</div>


<p>Finally, add the application-specific gems from <a class="ref" href="updating-showing-and-deleting-users#code-final_gemfile">Listing&nbsp;10.42</a> to the default Rails&nbsp;3.1 <code>Gemfile</code>, yielding <a class="ref" href="rails-3-1#code-gemfile_rails_3_1">Listing&nbsp;13.1</a>. (Note that you must use version <tt>1.3.4</tt> of the <tt>sqlite3</tt> gem; <tt>1.3.3</tt> won&rsquo;t work.)</p>

<div class="label" id="code-gemfile_rails_3_1"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.1.</span> <span class="description">The sample application <code>Gemfile</code> needed for Rails&nbsp;3.1.</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.1.0&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;gravatar_image_tag&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.0.pre2&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;will_paginate&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.pre2&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.4&#39;</span>

<span class="c1"># Asset template engines</span>
<span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 3.1.0.rc&quot;</span>
<span class="n">gem</span> <span class="s1">&#39;coffee-script&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.6.1&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;annotate&#39;</span><span class="p">,</span> <span class="s1">&#39;2.4.0&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;faker&#39;</span><span class="p">,</span> <span class="s1">&#39;0.3.1&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.6.1&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;webrat&#39;</span><span class="p">,</span> <span class="s1">&#39;0.7.1&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;spork&#39;</span><span class="p">,</span> <span class="s1">&#39;0.9.0.rc5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;factory_girl_rails&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Of course, before proceeding you should install the gems as well:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>




<div class="label" id="sec-getting_to_red"></div>


<h3><a id="sec-13_1_2" href="rails-3-1#sec-getting_to_red" class="heading"><span class="number">13.1.2</span> Getting to Red</a></h3>


<p>Having made a minimal skeleton Rails&nbsp;3.1 app in <a class="ref" href="rails-3-1#sec-installing_and_configuring_rails_3_1">Section&nbsp;13.1.1</a>, we&rsquo;re now ready to get the sample app working. As mentioned in the introduction to this section, our basic strategy is to copy over one file at a time; one possibility is to use the OS&nbsp;X Finder app (or the equivalent application on your system), as shown in <a class="ref" href="rails-3-1#fig-upgrade_with_finder">Figure&nbsp;13.1</a>.</p>

<div class="label" id="fig-upgrade_with_finder"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/upgrade_with_finder.png" alt="upgrade_with_finder" /></span></div><div class="caption"><span class="header">Figure 13.1: </span><span class="description">Upgrading the sample app by copying files one by one.&nbsp;<a href="http://railstutorial.org/images/figures/upgrade_with_finder-full.png">(full size)</a></span></div></div>


<p>The upgrade strategy in the companion screencast to this section is to copy over a single spec file, <code>spec/controllers/pages_controller_spec.rb</code>, and then try to get it to pass. After copying over the file, we initialize RSpec as in <a class="ref" href="static-pages#top">Chapter&nbsp;3</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate rspec:install
</pre></div>
</div>


<p>If you are using RSpec&nbsp;2.5, this step will fail, as Rails&nbsp;3.1 requires version <code>2.6.1</code> of the <tt>rspec-rails</tt> gem. If you use the <code>Gemfile</code> in <a class="ref" href="rails-3-1#code-gemfile_rails_3_1">Listing&nbsp;13.1</a>, this won&rsquo;t be a problem, but previous versions of this book used an earlier (and incompatible) version of the gem.</p>

<p>Next, try running the test suite:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>It will be Red initially, and our upgrade strategy is to analyze the error message and copy over files until the test suite passes. Once the partial test suite is Green, copy over the other tests in small groups, watch them fail, and then get them to pass. Lather, rinse, repeat.</p>

<p>Although the rest of this section covers some changes you will definitely have to make to get the application to work, this chapter doesn&rsquo;t cover all the details of the upgrade process, which in any case will vary by system. By the nature of this subject, it&rsquo;s easier to show the upgrade steps in a <a href="http://railstutorial.org/screencasts">screencast</a>, but if you have gotten this far in the <em>Ruby on Rails Tutorial</em> then you are probably up to the challenge posed by doing the upgrade yourself (<a class="ref" href="rails-3-1#sec-rails_3_1_exercises">Section&nbsp;13.3</a>).</p>

<div class="label" id="sec-minor_issues"></div>


<h3><a id="sec-13_1_3" href="rails-3-1#sec-minor_issues" class="heading"><span class="number">13.1.3</span> Minor issues</a></h3>


<p>When upgrading the sample app, you will encounter some (rather annoying) minor issues. This section mentions some of the problems I ran into (together with solutions), but of course <a href="http://www.catb.org/jargon/html/Y/YMMV.html">YMMV</a>.</p>

<div class="label" id="sec-will_paginate"></div>


<h4><a id="sec-13_1_3_1" href="rails-3-1#sec-will_paginate" class="heading">will_paginate</a></h4>


<p>In the process of trying to get from Red to Green, you will discover that the <tt>will_paginate</tt> gem is incompatible with Rails&nbsp;3.1, yielding an error that looks like this:</p>

<div class="code"><div class="highlight"><pre><span class="n">uninitialized</span> <span class="n">constant</span>
<span class="ss">ActiveRecord::Associations</span><span class="o">::</span><span class="no">AssociationCollection</span> <span class="p">(</span><span class="no">NameError</span><span class="p">)</span>
</pre></div>
</div>


<p>The solution (obtained by Googling the error message) is, quite unfortunately, to edit the <tt>will_paginate</tt> gem source code directly. This requires finding the source on your system, which might be tricky; on my system, it looks like this:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/.rvm/gems/ruby-1.9.2-p180@rails3_1tutorial/gems/
<span class="gp">$</span> mate will_paginate-3.0.pre2/lib/will_paginate/finders/active_record.rb
</pre></div>
</div>


<p>The fix is simple: we need to replace <code>AssociationCollection</code> to <code>CollectionAssociation</code>, as shown in the <a href="http://en.wikipedia.org/wiki/Diff">diff</a> in <a class="ref" href="rails-3-1#code-will_paginate_fix">Listing&nbsp;13.2</a>. (I have omitted a reference to <code>::ActiveRecord::Relation</code> to save on space, but you should leave it in.)
This change is a terrible <a href="http://www.catb.org/jargon/html/K/kludge.html">kludge</a>&mdash;among other things, it will break if we ever reinstall the <tt>will_paginate</tt> gem, and it will fail in production&mdash;but it works for now, and presumably this issue will be fixed in a future release of <tt>will_paginate</tt>.<sup class="footnote" id="fnref-13_1"><a href="#fn-13_1">1</a></sup></p>

<div class="label" id="code-will_paginate_fix"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.2.</span> <span class="description">The change needed in the <tt>will_paginate</tt> gem.</span> </div>
<div class="code"><div class="highlight"><pre>  # support pagination on associations and scopes
<span class="gd">- [::ActiveRecord::Associations::AssociationCollection].each do |klass|</span>
<span class="gi">+ [::ActiveRecord::Associations::CollectionAssociation].each do |klass|</span>
    klass.send(:include, ActiveRecord)
  end
end
</pre></div>
</div></div>




<div class="label" id="sec-pagination_spec"></div>


<h4><a id="sec-13_1_3_2" href="rails-3-1#sec-pagination_spec" class="heading">Pagination spec</a></h4>


<p>Another minor issue you may encounter is a failing pagination test. This is apparently due to a change in the way Rails&nbsp;3.1 constructs URLs compared to Rails&nbsp;3.0, and one rather hackish solution is simply to remove the URL specificity from the test, as shown in <a class="ref" href="rails-3-1#code-pagination_spec_diff">Listing&nbsp;13.3</a>.</p>

<div class="label" id="code-pagination_spec_diff"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.3.</span> <span class="description">The diff for the pagination test. <br /> <code>spec/controllers/users_controller_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre>         get :index
         response.should have_selector(&#39;div.pagination&#39;)
         response.should have_selector(&#39;span.disabled&#39;, :content =&gt; &quot;Previous&quot;)
<span class="gd">-        response.should have_selector(&#39;a&#39;, :href =&gt; &quot;/users?page=2&quot;,</span>
<span class="gd">-                                           :content =&gt; &quot;2&quot;)</span>
<span class="gd">-        response.should have_selector(&#39;a&#39;, :href =&gt; &quot;/users?page=2&quot;,</span>
<span class="gd">-                                           :content =&gt; &quot;Next&quot;)</span>
<span class="gi">+        response.should have_selector(&#39;a&#39;, :content =&gt; &quot;2&quot;)</span>
<span class="gi">+        response.should have_selector(&#39;a&#39;, :content =&gt; &quot;Next&quot;)</span>
       end

       it &quot;should have delete links for admins&quot; do  
</pre></div>
</div></div>


<p>After making this change, and copying over all the files from your main sample app, your test suite might even move from Red to Green. If it doesn&rsquo;t, keep iterating and Googling error messages until it does. (You might also consider the resources on the <a href="http://ruby.railstutorial.org/help">Rails Tutorial Help page</a>.)</p>

<div class="label" id="sec-major_differences"></div>


<h3><a id="sec-13_1_4" href="rails-3-1#sec-major_differences" class="heading"><span class="number">13.1.4</span> Major differences</a></h3>


<p>The &ldquo;major&rdquo; differences between the Rails&nbsp;3.0 and Rails&nbsp;3.1 sample apps aren&rsquo;t really that big&mdash;it&rsquo;s just that they affect virtually all Rails applications. In this section, we&rsquo;ll see how to incorporate these differences to complete our new Rails&nbsp;3.1 sample application.</p>

<div class="label" id="sec-asset_directories"></div>


<h4><a id="sec-13_1_4_1" href="rails-3-1#sec-asset_directories" class="heading">Asset directories</a></h4>


<p>The biggest practical difference between Rails&nbsp;3.0 and Rails&nbsp;3.1 apps is a change in the location of asset files such as images, stylesheets, and JavaScript files. In previous versions of Rails, these files all lived in the <code>public/</code> directory:</p>

<div class="code"><div class="highlight"><pre><span class="go">public/images/</span>
<span class="go">public/stylesheets/</span>
<span class="go">public/javascripts/</span>
</pre></div>
</div>


<p>In Rails&nbsp;3.1, the location of these files differs based on whether they are created by us or come from an external vendor. In the case of images we make or code we write, the files live in the <code>app/assets</code> directory:</p>

<div class="code"><div class="highlight"><pre><span class="go">app/assets/images/</span>
<span class="go">app/assets/stylesheets/</span>
<span class="go">app/assets/javascripts/</span>
</pre></div>
</div>


<p>In the case of code or images from external vendors, we use the <code>vendor/assets</code> directory:</p>

<div class="code"><div class="highlight"><pre><span class="go">vendor/assets/images/</span>
<span class="go">vendor/assets/stylesheets/</span>
<span class="go">vendor/assets/javascripts/</span>
</pre></div>
</div>


<p>For the sample app, the above discussion means placing the <code>public/stylesheets/custom.css</code> file in <code>app/assets/stylesheets/</code> and the logo image <code>public/images/logo.png</code> in <code>app/assets/images/</code>, while placing the <code>public/stylesheets/blueprint/</code> CSS directory in <code>vendor/assets/stylesheets</code>. These require minor changes to the layout file and stylesheets partial, as shown in <a class="ref" href="rails-3-1#code-layout_rails_3_1_diff">Listing&nbsp;13.4</a> and <a class="ref" href="rails-3-1#code-stylesheets_partial_rails_3_1">Listing&nbsp;13.5</a>.</p>

<div class="label" id="code-layout_rails_3_1_diff"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.4.</span> <span class="description">The diff for the layout file <code>app/views/layouts/application.html.erb</code>.</span> </div>
<div class="code"><div class="highlight"><pre>     &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;
     &lt;%= csrf_meta_tag %&gt;
     &lt;%= render &#39;layouts/stylesheets&#39; %&gt;
<span class="gd">-    &lt;%= javascript_include_tag :defaults %&gt;</span>
<span class="gi">+    &lt;%= stylesheet_link_tag &quot;application&quot; %&gt;</span>
<span class="gi">+    &lt;%= javascript_include_tag &quot;application&quot; %&gt;</span>
   &lt;/head&gt;
   &lt;body&gt;
     &lt;div class=&quot;container&quot;&gt;
</pre></div>
</div></div>




<div class="label" id="code-stylesheets_partial_rails_3_1"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.5.</span> <span class="description">The diff for the stylesheets partial <code>app/views/layouts/_stylesheets.html.erb</code>.</span> </div>
<div class="code"><div class="highlight"><pre> &lt;![endif]--&gt;
 &lt;%= stylesheet_link_tag &#39;blueprint/screen&#39;, :media =&gt; &#39;screen&#39; %&gt;
 &lt;%= stylesheet_link_tag &#39;blueprint/print&#39;,  :media =&gt; &#39;print&#39; %&gt;
 &lt;!--[if lt IE 8]&gt;&lt;%= stylesheet_link_tag &#39;blueprint/ie&#39; %&gt;&lt;![endif]--&gt;
<span class="gd">-&lt;%= stylesheet_link_tag &#39;custom&#39;, :media =&gt; &#39;screen&#39; %&gt;</span>
</pre></div>
</div></div>


<p>Note that both the stylesheet and JavaScript includes use the form</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="o">&lt;</span><span class="n">type</span><span class="o">&gt;</span><span class="n">_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
</div>


<p>where the argument is the string <code>"application"</code>. In the case of CSS, the application file will be <code>application.css</code>; in the case of JavaScript, it will be <code>application.js</code>. In both cases, the application files are generated for us by Rails, so that (for example) the contents of <code>custom.css</code> will be included automatically as part of <code>application.css</code>. These features are part of the <em>asset pipeline</em>, which is new in Rails&nbsp;3.1, and is discussed in more detail in <a class="ref" href="rails-3-1#sec-asset_pipeline">Section&nbsp;13.2.1</a>.</p>

<div class="label" id="sec-prototype_to_jquery"></div>


<h4><a id="sec-13_1_4_2" href="rails-3-1#sec-prototype_to_jquery" class="heading">Prototype to jQuery</a></h4>


<p>The second big change in Rails&nbsp;3.1 that affects a large number of apps is the change from Prototype to jQuery as the default JavaScript library. Of course, it is easy to switch back&mdash;just change <code>jquery-rails</code> to <code>prototype-rails</code> in the <code>Gemfile</code> (<a class="ref" href="rails-3-1#code-gemfile_rails_3_1">Listing&nbsp;13.1</a>)&mdash;but jQuery has high adoption rates among Rails developers, and making it the default has been a long time coming.</p>

<p>In the case of the sample application, the only functionality affected by the Prototype-to-jQuery switch is the Ajax in the follow/unfollow button covered in <a class="ref" href="following-users#sec-a_working_follow_button_with_ajax">Section&nbsp;12.2.5</a>. The principal syntactic difference is that, where Prototype writes</p>

<div class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;follow_form&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>to manipulate the <code>follow_form</code> CSS id, jQuery writes</p>

<div class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#follow_form&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>instead. This jQuery syntax, inspired by CSS, uses the&nbsp;<code>#</code> symbol to indicate a CSS&nbsp;id. (As you might guess, jQuery, like CSS, uses a dot&nbsp;<code>.</code> to manipulate CSS classes.) The resulting changes to the Ajax <code>create</code> and <code>destroy</code> files are shown in <a class="ref" href="rails-3-1#code-create_js_diff">Listing&nbsp;13.6</a> and <a class="ref" href="rails-3-1#code-destroy_js_diff">Listing&nbsp;13.7</a>, while the updated code itself appears in <a class="ref" href="rails-3-1#code-create_js_jquery">Listing&nbsp;13.8</a> and <a class="ref" href="rails-3-1#code-destroy_js_jquery">Listing&nbsp;13.9</a>. Note that, in addition to having a different syntax for manipulating the <a href="http://www.w3.org/DOM/">DOM</a>, jQuery uses the <code>html</code> method to modify the contents of an HTML element where Prototype uses <code>update</code>.</p>

<div class="label" id="code-create_js_diff"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.6.</span> <span class="description">The Prototype-to-jQuery diff for <code>create.js.erb</code>.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gd">- $(&quot;follow_form&quot;).update(&quot;&lt;%= escape_javascript(render(&#39;users/unfollow&#39;)) %&gt;&quot;)</span>
<span class="gd">- $(&quot;followers&quot;).update(&#39;&lt;%= &quot;#{@user.followers.count} followers&quot; %&gt;&#39;)</span>
<span class="gi">+ $(&quot;#follow_form&quot;).html(&quot;&lt;%= escape_javascript(render(&#39;users/unfollow&#39;)) %&gt;&quot;)</span>
<span class="gi">+ $(&quot;#followers&quot;).html(&#39;&lt;%= &quot;#{@user.followers.count} followers&quot; %&gt;&#39;)</span>
</pre></div>
</div></div>




<div class="label" id="code-destroy_js_diff"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.7.</span> <span class="description">The Prototype-to-jQuery diff for <code>destroy.js.erb</code>.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gd">- $(&quot;follow_form&quot;).update(&quot;&lt;%= escape_javascript(render(&#39;users/follow&#39;)) %&gt;&quot;)</span>
<span class="gd">- $(&quot;followers&quot;).update(&#39;&lt;%= &quot;#{@user.followers.count} followers&quot; %&gt;&#39;)</span>
<span class="gi">+ $(&quot;#follow_form&quot;).html(&quot;&lt;%= escape_javascript(render(&#39;users/follow&#39;)) %&gt;&quot;)</span>
<span class="gi">+ $(&quot;#followers&quot;).html(&#39;&lt;%= &quot;#{@user.followers.count} followers&quot; %&gt;&#39;)</span>
</pre></div>
</div></div>




<div class="label" id="code-create_js_jquery"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.8.</span> <span class="description">The jQuery code needed to create a following relationship. <br />  <code>app/views/relationships/create.js.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#follow_form&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= escape_javascript(render(&#39;users/unfollow&#39;)) %&gt;&quot;</span><span class="p">)</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#followers&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;%= &quot;#{@user.followers.count} followers&quot; %&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div></div>




<div class="label" id="code-destroy_js_jquery"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.9.</span> <span class="description">The jQuery code needed to destroy a following relationship. <br />  <code>app/views/relationships/destroy.js.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#follow_form&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= escape_javascript(render(&#39;users/follow&#39;)) %&gt;&quot;</span><span class="p">)</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#followers&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;%= &quot;#{@user.followers.count} followers&quot; %&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div></div>


<p>With these changes, and the changes to the asset locations from <a class="ref" href="rails-3-1#sec-asset_directories">Section&nbsp;13.1.4.1</a>, the new sample app should be complete and fully compatible with Rails&nbsp;3.1. (Don&rsquo;t forget&mdash;as I did in the Rails&nbsp;3.1 upgrade screencast&mdash;to rename the <code>README</code> and replace it with the <code>README.markdown</code> from <a class="ref" href="static-pages#code-sample_app_readme">Listing&nbsp;3.2</a>.)</p>

<div class="label" id="sec-new_features"></div>


<h2><a id="sec-13_2" href="rails-3-1#sec-new_features" class="heading"><span class="number">13.2</span> New features in Rails 3.1</a></h2>


<p>Rails&nbsp;3.1 contains some exciting new features, but it&rsquo;s important to emphasize that most of them are either <em>automatic</em> (included for free by Rails) or are <em>optional</em>. For an overview of the changes in Rails&nbsp;3.1, the post <a href="http://weblog.rubyonrails.org/2011/5/22/rails-3-1-release-candidate">Rails&nbsp;3.1: Release candidate</a> is a good place to start. This section discusses a few of them in more detail.</p>

<div class="label" id="sec-asset_pipeline"></div>


<h3><a id="sec-13_2_1" href="rails-3-1#sec-asset_pipeline" class="heading"><span class="number">13.2.1</span> Asset pipeline</a></h3>


<p>One of the most exciting Rails&nbsp;3.1 features is the <em>asset pipeline</em>, which Rails creator David Heinemeier Hansson discussed in <a href="http://www.youtube.com/watch?v=cGdCI2HhfAU">his keynote at RailsConf 2011</a>. The asset pipeline is a suite of technologies designed to make the deployment of assets&mdash;i.e., images, stylesheets, and JavaScript&mdash;more efficient and convenient. For example, all stylesheets and JavaScript files are concatenated automatically and served as single files in production. (The changes described in <a class="ref" href="rails-3-1#sec-asset_directories">Section&nbsp;13.1.4.1</a> are the necessary prerequisites to using the asset pipeline.) To learn about the details, see the <a href="http://railscasts.com/episodes/265-rails-3-1-overview">Railscast Rails&nbsp;3.1 Overview</a> and Ville Lautanala&rsquo;s post on the <a href="http://blog.nodeta.com/2011/06/14/rails-3-1-asset-pipeline-in-the-real-world/">Rails 3.1 Asset Pipeline in the Real World</a>. A future edition of this book will integrate the asset pipeline from the beginning.</p>

<div class="label" id="sec-reversible_migrations"></div>


<h3><a id="sec-13_2_2" href="rails-3-1#sec-reversible_migrations" class="heading"><span class="number">13.2.2</span> Reversible migrations</a></h3>


<p>Rails&nbsp;3.1 also introduces <em>reversible migrations</em>, which allow Rails to infer the <code>up</code> and <code>down</code> methods used to migrate the database up and down. For example, the migration in <a class="ref" href="modeling-and-viewing-users-one#code-users_migration">Listing&nbsp;6.2</a>, reproduced below as <a class="ref" href="rails-3-1#code-users_migration_redux">Listing&nbsp;13.10</a>, can in Rails&nbsp;3.1 appear as in <a class="ref" href="rails-3-1#code-users_migration_reversible">Listing&nbsp;13.11</a>.</p>

<div class="label" id="code-users_migration_redux"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.10.</span> <span class="description">Migration for the User model (to create a <code>users</code> table). <br /> <code>db/migrate/&lt;timestamp&gt;_create_users.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Migration</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
    <span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:email</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
    <span class="n">drop_table</span> <span class="ss">:users</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-users_migration_reversible"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 13.11.</span> <span class="description">A reversible (Rails&nbsp;3.1&ndash;style) migration for the User model.</span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord::Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:email</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</div></div>


<p>In the case of <a class="ref" href="rails-3-1#code-users_migration_reversible">Listing&nbsp;13.11</a>, Rails uses the <code>change</code> method to construct the appropriate up and down migrations on the fly.</p>

<p>Of course, not all migrations can be inferred in this manner, so Rails&nbsp;3.1 still allows developers to define their own <code>up</code> and <code>down</code> methods. Indeed, migrations are backwards-compatible, so the migration code from previous chapters will still work. Of course, a future edition of this book will generate migrations using Rails&nbsp;3.1 (or its successor), and hence will include reversible migrations as a matter of course.</p>

<div class="label" id="sec-sass_and_coffeescript"></div>


<h3><a id="sec-13_2_3" href="rails-3-1#sec-sass_and_coffeescript" class="heading"><span class="number">13.2.3</span> Sass and CoffeeScript</a></h3>


<p>Finally, by default Rails&nbsp;3.1 includes <a href="http://sass-lang.com/">Sass</a>, which is a language for creating &ldquo;Syntactically awesome stylesheets&rdquo;, and
<a href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a>, which is a syntactically elegant language that compiles into JavaScript. For good introductions to each, see the <a href="http://railscasts.com/episodes/267-coffeescript-basics">Railscast on CoffeeScript Basics</a> and the <a href="http://railscasts.com/episodes/268-sass-basics">Railscast on Sass Basics</a>.</p>

<p>At first glance, these new defaults seem like a big change to the way Rails applications are developed, and several commentators have expressed concern that the addition of Sass and CoffeeScript make Rails more difficult to learn. In this context, it is essential to understand that <strong>using Sass or CoffeeScript in Rails&nbsp;3.1 applications is optional</strong>. Every valid CSS file is also a valid Sass file, so if you don&rsquo;t want to use Sass, you don&rsquo;t have to. Similarly, while you <em>can</em> write CoffeeScript if you want to, JavaScript is still fully supported: <code>.js</code> files in <code>app/assets/javascripts</code> or <code>vendor/assets/javascripts</code> will be included in the concatenated <code>application.js</code> file that is part of the Rails&nbsp;3.1 asset pipeline.</p>

<p>In other words, vanilla CSS and JavaScript will always work, so there is no cause for alarm. On the other hand, Sass and CoffeeScript are awesome (there&rsquo;s a reason they&rsquo;re now part of the default installation), and in a future edition of this book I plan to cover them in more depth.</p>

<div class="label" id="sec-rails_3_1_exercises"></div>


<h2><a id="sec-13_3" href="rails-3-1#sec-rails_3_1_exercises" class="heading"><span class="number">13.3</span> Exercises</a></h2>




<ol>
<li>Complete the upgrade started in <a class="ref" href="rails-3-1#sec-upgrading_the_sample_app">Section&nbsp;13.1</a> if you haven&rsquo;t already. Don&rsquo;t give up until your test suite is Green and the application (running locally) looks and behaves correctly.</li>

<li><strong>(hard)</strong> Rails&nbsp;3.1 supports roll-your-own authentication with a new method called <code>has_secure_password</code>. Starting with the <a href="http://railscasts.com/episodes/270-authentication-in-rails-3-1">Railscast on Authentication in Rails&nbsp;3.1</a>, refactor the authentication framework from <a class="ref" href="modeling-and-viewing-users-two#top">Chapter&nbsp;7</a> to use the new features of Rails&nbsp;3.1. (Naturally, a future edition of this book will include these new features from the start.)</li>

</ol>


<div class="navigation">  <a class="prev_page" href="following-users#top">
    &laquo;&nbsp;<span class="number">Chapter 12</span> Following users
  </a>
</div><div class="footnotes">
<ol>
<li id="fn-13_1">To use the modified gem in production at Heroku, we would have to build our own gem based on a fork of <tt>will_paginate</tt>. Since the fix is so easy, I&rsquo;d guess this issue will be fixed by the time Heroku fully supports Rails&nbsp;3.1.&nbsp;<a class="arrow" href="#fnref-13_1">&uarr;</a></li>
</ol>
</div>



